{{FrontSide}}

<main>
    <div class="answerTile">
        <section id=Answer>
            <span>{{English}}</span>
            <article class="meanings">
                {{Meanings}}
            </article>
            <article class="info secondary">
                <span>{{POS}}</span>
            </article>
        </section>
        <article class="examples">
            {{#ExampleAudio}}
                <div class="playButton" onclick="this.nextElementSibling.play();">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M560-131v-82q90-26 145-100t55-168q0-94-55-168T560-749v-82q124 28 202 125.5T840-481q0 127-78 224.5T560-131ZM120-360v-240h160l200-200v640L280-360H120Zm440 40v-322q47 22 73.5 66t26.5 96q0 51-26.5 94.5T560-320Z"/></svg>
                </div>
                <audio src="{{ExampleAudio}}"></audio>
            {{/ExampleAudio}}
            {{^ExampleAudio}}
                <div class="playButton disabled" >
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M792-56 671-177q-25 16-53 27.5T560-131v-82q14-5 27.5-10t25.5-12L480-368v208L280-360H120v-240h128L56-792l56-56 736 736-56 56Zm-8-232-58-58q17-31 25.5-65t8.5-70q0-94-55-168T560-749v-82q124 28 202 125.5T840-481q0 53-14.5 102T784-288ZM650-422l-90-90v-130q47 22 73.5 66t26.5 96q0 15-2.5 29.5T650-422ZM480-592 376-696l104-104v208Z"/></svg>
                </div>
            {{/ExampleAudio}}
            <span>{{ExampleSentence}}</span>
        </article>
        {{#GrammarForms}}
            <article class="forms">
                <div class="dropdown">Alternative forms</div>
                {{GrammarForms}}
                <div class="expandButton" onclick="if (this.classList.contains('collapse')) {this.previousElementSibling.style.display='none';this.classList.remove('collapse');} else {this.previousElementSibling.style.display='block';this.classList.add('collapse');};">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z"/></svg>
                </div>
            </article>
        {{/GrammarForms}}
    </div>
    {{#English_2}}
    <div class="answerTile">
        <section id=Answer>
            <span>{{English_2}}</span>
            <article class="meanings">
                {{Meanings_2}}
            </article>
            <article class="info secondary">
                <span>{{POS_2}}</span>
            </article>
        </section>
        <article class="examples">
            {{#ExampleAudio_2}}
                <div class="playButton" onclick="this.nextElementSibling.play();">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M560-131v-82q90-26 145-100t55-168q0-94-55-168T560-749v-82q124 28 202 125.5T840-481q0 127-78 224.5T560-131ZM120-360v-240h160l200-200v640L280-360H120Zm440 40v-322q47 22 73.5 66t26.5 96q0 51-26.5 94.5T560-320Z"/></svg>
                </div>
                <audio src="{{ExampleAudio_2}}"></audio>
            {{/ExampleAudio_2}}
            <span>{{ExampleSentence_2}}</span>
        </article>
        {{#GrammarForms_2}}
            <article class="forms">
                <div class="dropdown">Alternative forms</div>
                {{GrammarForms_2}}
                <div class="expandButton" onclick="if (this.classList.contains('collapse')) {this.previousElementSibling.style.display='none';this.classList.remove('collapse');} else {this.previousElementSibling.style.display='block';this.classList.add('collapse');};">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z"/></svg>
                </div>
            </article>
        {{/GrammarForms_2}}
    </div>
    {{/English_2}}
    {{#English_3}}
    <div class="answerTile">
        <section id=Answer>
            <span>{{English_3}}</span>
            <article class="meanings">
                {{Meanings_3}}
            </article>
            <article class="info secondary">
                <span>{{POS_3}}</span>
            </article>
        </section>
        <article class="examples">
            {{#ExampleAudio_3}}
                <div class="playButton" onclick="this.nextElementSibling.play();">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M560-131v-82q90-26 145-100t55-168q0-94-55-168T560-749v-82q124 28 202 125.5T840-481q0 127-78 224.5T560-131ZM120-360v-240h160l200-200v640L280-360H120Zm440 40v-322q47 22 73.5 66t26.5 96q0 51-26.5 94.5T560-320Z"/></svg>
                </div>
                <audio src="{{ExampleAudio_3}}"></audio>
            {{/ExampleAudio_3}}
            <span>{{ExampleSentence_3}}</span>
        </article>
        {{#GrammarForms_3}}
            <article class="forms">
                <div class="dropdown">Alternative forms</div>
                {{GrammarForms_3}}
                <div class="expandButton" onclick="if (this.classList.contains('collapse')) {this.previousElementSibling.style.display='none';this.classList.remove('collapse');} else {this.previousElementSibling.style.display='block';this.classList.add('collapse');};">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor"><path d="M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z"/></svg>
                </div>
            </article>
        {{/GrammarForms_3}}
    </div>
    {{/English_3}}
</main>

<script>
    (() => {

        let valid = false;

        function resultAudio(valid) {
            let audio = document.createElement("audio");
            if (valid) {
                audio.src = "https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg";
            } else {
                audio.src = "https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg";
            };
            audio.volume = 0.4;
            return audio
        };

        async function playResultAudio() {
            //////// audio to confirm valid answer ////////
            try {
                let audio = resultAudio(valid);
                await audio.play();
            } catch {};
        };

        function processInput() {
            let input = "";
            let typeans = document.getElementById("typeans");
            if (typeans) {
                for (let elem of document.getElementById("typeans").children) {
                    if (elem.className != "typeMissed") {
                        input += elem.textContent;
                    };
                };
            } else {return};

            let inputElement = document.createElement("div");
            inputElement.textContent = input;
            inputElement.className = "typedInput wrong";
            let matched = false;
            let inputContainer = typeans.parentElement.parentElement;
            typeans.parentElement.remove();

            for (let answerElem of document.querySelectorAll("#Answer>span:first-child")) {
                if (answerElem.textContent.trim().toLowerCase() == input.toLowerCase()) {
                    matched = true;
                    answerElem.className = "typedInput correct";
                };
            };
            for (let meaningElem of document.querySelectorAll("article.meanings li")) {
                if (meaningElem.textContent.trim().toLowerCase() == input.toLowerCase()) {
                    matched = true;
                    meaningElem.className = "typedInput correct";
                };
            };
            if (!matched) {
                inputContainer.appendChild(inputElement);
            } else {
                valid = true;
            };
        }

        function correctTypeans() {
            let typeElement = document.getElementById("typeans")
            if (typeElement.children.length == 0) {
                typeElement.remove();
                return
            };
            let deleteSwitch = false;
            let toDelete = Array()
            for (let child of typeElement.children) {
                if (child.tagName.toLowerCase() == "br") {
                    deleteSwitch = true;
                };
                if (deleteSwitch == true) {
                    toDelete.push(child);
                };
            };
            for (let x of toDelete) {
                typeElement.removeChild(x);
            };
        };

        async function initialize() {
            correctTypeans();
            processInput();
        };

        if (onUpdateHook !== undefined) {
            onUpdateHook.push(initialize);
        }

        if (onShownHook !== undefined) {
            // onShownHook.push(playResultAudio);
        }

    })();
</script>